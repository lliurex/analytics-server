var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(c){return c.raw=c};$jscomp.createTemplateTagFirstArgWithRaw=function(c,a){c.raw=a;return c};$jscomp.arrayIteratorImpl=function(c){var a=0;return function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.makeIterator=function(c){var a="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];return a?a.call(c):$jscomp.arrayIterator(c)};
function drawChart(c,a,b,g){var k=.95*$("#"+b).parent().width();a={title:a,width:k,height:20*g,fontSize:10,legend:"none",hAxis:{viewWindow:{min:0}},chartArea:{left:"10%",right:"5%",top:"50",width:"100%",height:"100%"},backgroundColor:"transparent"};c=new google.visualization.DataView(c);c.setColumns([0,1,{calc:"stringify",sourceColumn:1,type:"string",role:"annotation"}]);b=new google.visualization.BarChart(document.getElementById(b));google.visualization.events.addListener(b,"ready",ready_charts);
b.draw(c,a)}function get_sizes(c){c=.95*$("#"+c).parent().width();$(window).height();return{width:c,height:"auto"}}function hslToHex(c,a,b){b/=100;var g=a*Math.min(b,1-b)/100;a=function(k){k=(k+c/30)%12;return Math.round(255*(b-g*Math.max(Math.min(k-3,9-k,1),-1))).toString(16).padStart(2,"0")};return"#"+a(0)+a(8)+a(4)}function GetColors(c){for(var a=[],b=Math.trunc(360/c),g=0;g<c;g++)a.push(hslToHex(g*b,100,50));return a}var isObject=function(c){return"[object Object]"===Object.prototype.toString.call(c)};
function build_data_per_month(c,a,b,g){var k={},f={},d=[],q=[],h=new Date,l=[];b=$jscomp.makeIterator(Object.entries(b));for(var e=b.next();!e.done;e=b.next()){e=$jscomp.makeIterator(e.value);var w=e.next().value,v=e.next().value;nmonthidx=parseInt(w);if(0!=nmonthidx){var t=new Date(h.getFullYear(),h.getMonth()-nmonthidx+1,1);t.setDate(t.getDate()-1)}else t=new Date(h.getFullYear(),h.getMonth(),h.getDate());q.push(t);e={};var p=$jscomp.makeIterator(Object.entries(v)),n=p.next();a:for(;!n.done;n=p.next()){var r=
$jscomp.makeIterator(n.value);n=r.next().value;r=r.next().value;e=e||{};r=Object.entries(r);if(0==r.length){k=e[w]=v;break a}r=$jscomp.makeIterator(r);for(var m=r.next();!m.done;m=r.next()){m=$jscomp.makeIterator(m.value);var y=m.next().value,u=m.next().value;"releases"==c?(m=n,k[n]=!0):(m=y,k[y]=!0);if(isObject(u))for(y=$jscomp.makeIterator(Object.entries(u)),u=y.next();!u.done;u=y.next()){var x=$jscomp.makeIterator(u.value);u=x.next().value;x=x.next().value;var z="all_"+u;f[u]=!0;e[z]=e[z]||0;e[m]=
e[m]||{};e[m][u]=e[m][u]||0;e[m].all=e[m].all||0;e[m][u]+=x;e[m].all+=x;e[z]+=x}else e.all=e.all||0,e[m]=e[m]||0,e[m]+=u,e.all+=u}}w=0;0==a?(v=Object.keys(k).length,p=Object.keys(f).length,0==p&&(p=1),0==l.length&&(l=GetColors(v*p))):(v=Object.keys(f).length,0==l.length&&(l=GetColors(v)));t=[t];v=$jscomp.makeIterator(Object.entries(e).sort());for(p=v.next();!p.done;p=v.next())if(n=$jscomp.makeIterator(p.value),p=n.next().value,n=n.next().value,a||!p.startsWith("all"))if(!a||p.startsWith("all"))if(isObject(n))for(p=
$jscomp.makeIterator(Object.entries(e[p]).sort()),n=p.next();!n.done;n=p.next()){if(r=$jscomp.makeIterator(n.value),n=r.next().value,r=r.next().value,a||!n.startsWith("all"))if(!a||n.startsWith("all"))t.push(r),t.push(l[w]),w++}else t.push(n),t.push(l[w]),w++;d.push(t)}c=new google.visualization.DataTable;c.addColumn({type:"date",role:"domain"},"Release");k=$jscomp.makeIterator(Object.keys(a?f:k).sort());for(h=k.next();!h.done;h=k.next())if(h=h.value,a||0==Object.keys(f).length)c.addColumn("number",
"Total "+h),c.addColumn({type:"string",role:"style"},"Style "+h);else for(b=$jscomp.makeIterator(Object.keys(f).sort()),e=b.next();!e.done;e=b.next())e=h+" "+e.value,c.addColumn("number","Total "+e),c.addColumn({type:"string",role:"style"},"Style "+e);c.addRows(d);return{data:c,options:{title:g,curveType:"function",isStacked:!1,hAxis:{title:"Months",ticks:q,format:"MMM"},vAxis:{title:"Num instances",viewWindow:{min:0},format:"#"},legend:{textStyle:{fontSize:10}},chartArea:{left:"5%",right:"10%"},
focusTarget:"category",colors:l,lineWidth:5,tooltip:{textStyle:{fontSize:10}},backgroundColor:"transparent"}}}
function build_data_from_array(c,a){var b=[],g=new Date,k=new google.visualization.DataTable;k.addColumn({type:"date",role:"domain"},"Nhosts");k.addColumn("number",a);for(var f=[],d=0;d<c.length;d++){var q=g.getMonth(),h=g.getFullYear();0==d?h=new Date(g):(h=new Date(h,q,1),h.setDate(h.getDate()-1),g.setMonth(q-1));b.push(h);f.push([h,c[d]])}k.addRows(f);return{data:k,options:{title:a,curveType:"function",isStacked:!1,hAxis:{title:"Months",ticks:b,format:"MMM"},vAxis:{title:"Num hosts",minValue:0,
maxValue:"automatic",viewWindowMode:"pretty",viewWindow:{min:0,max:"auto"},format:"#"},legend:{textStyle:{fontSize:10}},chartArea:{left:"5%",right:"10%"},focusTarget:"category",lineWidth:5,tooltip:{textStyle:{fontSize:10}},backgroundColor:"transparent"}}}
function doExtendedChart(){end_load_time=get_time();var c=window.location.search.substr(1);""!=c&&(c="?"+c);var a={};start_get_time=get_time();$("#accordion").append('<div id="loading"></div>');start_graph_time=end_get_time=0;$.ajax({datatype:"json",url:"./GetExtendedStats"+c,success:function(b){start_graph_time=end_get_time=get_time();var g=null,k={machines_per_month:{},clients_per_month:{},freq_updates_per_month:{},change_releases:{},change_flavours:{},count_ltsp:{},count_mode:{},architectures:{},
mem:{},cpu:{}},f;for(f in b){if("clients"==f)for(var d in k)if(b[f][d])switch(d){case "machines_per_month":a.clients_per_month||(a.clients_per_month={});a.clients_per_month.hosts||(a.clients_per_month.hosts={});a.clients_per_month.title="Machines";a.clients_per_month.hosts.graph=build_data_from_array(b[f][d],"Number of unique machines used");a.clients_per_month.hosts.title="Number of unique machines used";break;case "clients_per_month":a.clients_per_month||(a.clients_per_month={});a.clients_per_month.releases||
(a.clients_per_month.releases={});a.clients_per_month.flavours||(a.clients_per_month.flavours={});a[d].title="Machines";a[d].releases.graph=build_data_per_month("releases",!1,b[f][d],"Number instances by release per month");a[d].releases.title="Number instances by release per month";a[d].flavours.graph=build_data_per_month("flavours",!1,b[f][d],"Number instances by flavour per month");a[d].flavours.title="Number instances by flavour per month";break;case "freq_updates_per_month":a.changes||(a.changes=
{},a.changes.title="Upgrades");a.changes.updates||(a.changes.updates={});a.changes.updates.graph=build_data_from_array(b[f][d],"Number updates per month");a.changes.updates.title="Number updates per month";break;case "change_releases":a.changes||(a.changes={},a.changes.title="Upgrades");a.changes.releases||(a.changes.releases={});a.changes.releases.graph=build_data_from_array(b[f][d],"Change releases per month");a.changes.releases.title="Change releases per month";break;case "change_flavours":a.changes||
(a.changes={},a.changes.title="Changes");a.changes.flavours||(a.changes.flavours={});a.changes.flavours.graph=build_data_from_array(b[f][d],"Change flavours per month");a.changes.flavours.title="Change flavours per month";break;case "architectures":a[d]||(a[d]={global:{},releases:{},flavours:{}},a[d].title="Architectures");a[d].global.graph=build_data_per_month("flavours",!0,b[f][d],"Architectures per month");a[d].global.title="Architectures distribution per month";a[d].releases.graph=build_data_per_month("releases",
!1,b[f][d],"Architectures by release per month");a[d].releases.title="Architectures distribution by release per month";a[d].flavours.graph=build_data_per_month("flavours",!1,b[f][d],"Architectures by flavour per month");a[d].flavours.title="Architectures distribution by flavour per month";break;case "mem":a[d]||(a[d]={global:{},releases:{},flavours:{}},a[d].title="Memory");a[d].global.graph=build_data_per_month("flavours",!0,b[f][d],"Memory per month");a[d].global.title="Memory distribution per month";
a[d].releases.graph=build_data_per_month("releases",!1,b[f][d],"Memory by release per month");a[d].releases.title="Memory distribution by release per month";a[d].flavours.graph=build_data_per_month("flavours",!1,b[f][d],"Memory by flavour per month");a[d].flavours.title="Memory distribution by flavour per month";break;case "cpu":a.cpu||(a.cpu={global:{},releases:{},flavours:{}},a.cpu.title="CpuS");a.cpu.global.graph=build_data_per_month("flavours",!0,b[f][d],"Number CpuS per month");a.cpu.global.title=
"Number CpuS distribution per month";a.cpu.releases.graph=build_data_per_month("releases",!1,b[f][d],"Number CpuS by release per month");a.cpu.releases.title="Number CpuS distribution by release per month";a.cpu.flavours.graph=build_data_per_month("flavours",!1,b[f][d],"Number CpuS by release per month");a.cpu.flavours.title="Number CpuS distribution by flavour per month";break;case "count_ltsp":case "count_mode":a.ltsp||(a.ltsp={},a.ltsp.title="LTSP Usage"),"count_ltsp"!=d||a.ltsp.usage||(a.ltsp.usage=
{},a.ltsp.usage.graph=build_data_per_month("releases",!1,b[f][d],"LTSP usage per month"),a.ltsp.usage.title="LTSP Use"),"count_mode"!=d||a.ltsp.modes||(a.ltsp.modes={},a.ltsp.modes.graph=build_data_per_month("releases",!1,b[f][d],"LTSP type by type per month"),a.ltsp.modes.title="Clients LTSP Mode")}if("apps"==f)for(var q in b.apps)if(b.apps[q].app&&b.apps[q].app_use){g=b.apps[q].app;var h="usage_"+q;a[h]={};a[h].title="Application usage "+g;a[h].releases={};a[h].releases.graph=build_data_per_month("releases",
!1,b[f][q].app_use,"Application use by release per month ("+g+")");a[h].releases.title="Use per month for application "+g;a[h].flavours={};a[h].flavours.graph=build_data_per_month("flavours",!1,b[f][q].app_use,"Application use by flavour per month ("+g+")");a[h].flavours.title="Use per month for application "+g}f.startsWith("debug")&&("debug_query_time"==f&&(query_time=b[f]),"debug_keep_alive"==f&&(keep_alive=b[f]))}for(var l in a)if(a[l].title){$("#accordion").append('<h3 class="'+l+'">'+a[l].title+
'</h3><div id="'+l+'"></div>');for(var e in a[l])"title"!=e&&a[l][e].graph&&($("#"+l).append("<div id="+l+"_"+e+"></div>"),b=get_sizes(l),a[l][e].graph.options.width=b.width,a[l][e].graph.options.height=b.height,(new google.visualization.LineChart(document.getElementById(l+"_"+e))).draw(a[l][e].graph.data,a[l][e].graph.options))}$("#loading").remove();$("#accordion").accordion({active:!1,collapsible:!0,heightStyle:"content",autoHeight:!1});null!=g&&$(".app_use").click();end_graph_time=get_time();
print_stats(end_graph_time,query_time);run_css_fixes()},async:!0})}function run_css_fixes(){$("#accordion>div>div:last-child svg").css("height",String(1.1*Number($("#accordion>div>div:last-child svg").css("height").slice(0,-2)))+"px")}function param_to_obj(c){"?"==c.substr(0,1)&&(c=c.substr(1));if(""==c)return"Undefined";var a={};c.split("&").forEach(function(b){b=b.split("=");a[b[0]]=decodeURIComponent(b[1])});return a}
function doChart(c){c=void 0===c?"":c;var a=window.location.search.substr(1),b=3;""!=a&&(a="?"+a,params=param_to_obj(a),params.hasOwnProperty("init")&&params.hasOwnProperty("window")?b=1:a="");end_load_time=get_time();start_get_time=get_time();$("#accordion").append('<div id="loading"></div>');""==c?(url="./GetStats"+a,limit=10):(url="./GetLliurexStats"+a,limit=1E3);$.getJSON(url,function(g){start_graph_time=end_get_time=get_time();count=0;for(key in g)if(!key.startsWith("debug"))for(key2 in g[key])count++;
max_graph=count*b;obj=[];var k,f;for(distro in g)"debug_init_range"==distro&&(k=g[distro]),"debug_end_range"==distro&&(f=g[distro]),"debug_query_time"==distro&&(query_time=g[distro]),"debug_keep_alive"==distro&&(keep_alive=g[distro]);for(distro in g)if(!distro.startsWith("debug"))for(sabor in g[distro]){for(var d=function(e,w){$("div."+w).append('<div id="'+divname+i+'"></div>');var v=0,t=new google.visualization.DataTable;t.addColumn("string","App");t.addColumn("number","Count");for(var p=e[0],n=
e[1],r=0;r<p.length;r++)t.addRow(p[r]),v++;for(;10>v;)t.addRow(["",0]),v++;obj.push(t);titles[i]=titles[i]+" (Total clients: "+n.nclients+")";drawChart(obj[obj.length-1],titles[i],divname+i,v);i++},q=g[distro][sabor],h=!0,l=0;l<q.length;l++)Array.isArray(q[l])||(h=!1);divname="chart_"+distro+"_"+sabor;$("#accordion").append("<h3>Distro "+distro+"("+sabor+")</h3>");$("#accordion").append('<div class="'+divname+'"></h3>');i=0;if(h)for(l in b=q.length,titles=["Top apps este mes","Top apps ultimo mes",
"Top apps penultimo mes"],q)d(q[l],divname);else b=1,titles=["Top apps from "+k+" until "+f],d(q,divname)}end_graph_time=get_time();print_stats(end_graph_time,query_time)})}num_ready=0;function ready_charts(){num_ready++;num_ready==max_graph&&($("#accordion>#loading").remove(),$("#accordion").accordion({active:!1,collapsible:!0,heightStyle:"content",autoHeight:!1}),run_css_fixes())}
function print_stats(c,a){c=void 0===c?0:c;a=void 0===a?0:a;var b=parseFloat((end_get_time-start_get_time)/1E3-a).toFixed(3),g=parseFloat(a).toFixed(3);0>b&&(b=parseFloat(g)+parseFloat(b),b=b.toFixed(3),g=0);var k=(end_load_time-start_load_time)/1E3,f=(c-start_graph_time)/1E3;b=b.toString();0==g&&(g=g.toString());k=k.toString();f=f.toString();$("#stats_box").append('<span class="stats">Load time: '+k+" sec</span>");$("#stats_box").append('<span class="stats">Get time: '+b+" sec</span>");$("#stats_box").append('<span class="stats">Graph time: '+
f+" sec</span>");$("#stats_box").append('<span class="stats">Query time: '+g+" sec</span>")}function get_time(){return Date.now?Date.now():(new Date).getTime()}var start_graph_time=0,end_graph_time=0,start_load_time=get_time(),end_load_time=0,start_get_time=0,end_get_time=0,query_time="",keep_alive="";